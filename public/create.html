<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create QR Code - SimplyQR</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="/css/style.css?v=5">
</head>
<body>
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div style="display: flex; align-items: center; gap: 1rem;">
      <a href="/dashboard" style="color: inherit; text-decoration: none; display: flex; align-items: center; gap: 1rem;">
        <div style="width: 48px; height: 48px; background: linear-gradient(135deg, var(--primary-emerald), var(--primary-emerald-dark)); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; color: white; padding: 10px;">
          <i data-lucide="qr-code" style="width: 28px; height: 28px;"></i>
        </div>
        <h1 style="font-size: var(--text-2xl);">SimplyQR</h1>
      </a>
      <span style="color: var(--text-tertiary); font-size: var(--text-lg); margin-left: var(--space-sm);">|</span>
      <h2 style="font-size: var(--text-lg); color: var(--text-secondary); font-weight: var(--font-medium);" id="page-title">Create QR Code</h2>
    </div>

    <div style="display: flex; align-items: center; gap: 1rem;">
      <a href="/dashboard" class="btn btn-secondary btn-sm">
        <i data-lucide="arrow-left" style="width: 16px; height: 16px;"></i>
        Back to Dashboard
      </a>
    </div>
  </div>

  <div style="display: flex; min-height: calc(100vh - 73px); max-width: 1600px; margin: 0 auto; width: 100%;">
    <!-- Form Section -->
    <div style="flex: 1; padding: var(--space-2xl); min-width: 0;">
      <!-- Alert Container -->
      <div id="alert-container"></div>

      <form id="qr-form">
        <!-- Basic Info Section -->
        <div class="card" style="margin-bottom: var(--space-xl);">
          <h3 style="margin-bottom: var(--space-lg);">Basic Information</h3>

          <div class="form-group">
            <label class="form-label" for="qr-name">QR Code Name *</label>
            <input
              type="text"
              id="qr-name"
              class="input-field"
              placeholder="e.g., My Website, Contact Card"
              required
            >
          </div>

          <div class="form-group">
            <label class="form-label">Type *</label>
            <p class="form-helper" style="margin-top: 0;">Where should your QR code scan to?</p>
            <div class="qr-type-grid">
              <div class="qr-type-card active" data-type="url">
                <i data-lucide="globe" class="qr-type-icon"></i>
                <span class="qr-type-label">URL</span>
              </div>
              <div class="qr-type-card" data-type="text">
                <i data-lucide="file-text" class="qr-type-icon"></i>
                <span class="qr-type-label">Text</span>
              </div>
              <div class="qr-type-card" data-type="vcard">
                <i data-lucide="user" class="qr-type-icon"></i>
                <span class="qr-type-label">vCard</span>
              </div>
              <div class="qr-type-card" data-type="wifi">
                <i data-lucide="wifi" class="qr-type-icon"></i>
                <span class="qr-type-label">WiFi</span>
              </div>
              <div class="qr-type-card" data-type="email">
                <i data-lucide="mail" class="qr-type-icon"></i>
                <span class="qr-type-label">Email</span>
              </div>
              <div class="qr-type-card" data-type="sms">
                <i data-lucide="message-square" class="qr-type-icon"></i>
                <span class="qr-type-label">SMS</span>
              </div>
              <div class="qr-type-card" data-type="phone">
                <i data-lucide="phone" class="qr-type-icon"></i>
                <span class="qr-type-label">Phone</span>
              </div>
            </div>
            <!-- Hidden input to store selected type -->
            <input type="hidden" id="qr-type" value="url" required>
          </div>

          <!-- Dynamic Content Fields -->
          <div id="content-fields"></div>

          <div class="form-group">
            <label class="form-label" for="qr-notes">Notes (optional)</label>
            <textarea
              id="qr-notes"
              class="input-field"
              placeholder="Add any notes about this QR code..."
              rows="3"
            ></textarea>
          </div>
        </div>

        <!-- Organization Section -->
        <div class="card" style="margin-bottom: var(--space-xl);">
          <h3 style="margin-bottom: var(--space-lg);">Organization</h3>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-md);">
            <div class="form-group" style="margin-bottom: 0;">
              <label class="form-label" for="qr-tags">Tags</label>
              <input
                type="text"
                id="qr-tags"
                class="input-field"
                placeholder="work, marketing, personal"
              >
            </div>

            <div class="form-group" style="margin-bottom: 0;">
              <label class="form-label" for="qr-folder">Folder</label>
              <div class="folder-dropdown-container">
                <input
                  type="text"
                  id="qr-folder"
                  class="input-field"
                  placeholder="e.g., Client Work"
                  autocomplete="off"
                >
                <button type="button" class="folder-clear-btn" id="folder-clear-btn" style="display: none;" title="Clear folder">
                  <i data-lucide="x" style="width: 16px; height: 16px;"></i>
                </button>
                <button type="button" class="folder-dropdown-trigger" id="folder-dropdown-trigger">
                  <i data-lucide="chevron-down" style="width: 16px; height: 16px;"></i>
                </button>
                <div class="folder-dropdown-menu" id="folder-dropdown-menu">
                  <div class="folder-dropdown-search">
                    <input
                      type="text"
                      id="folder-search-input"
                      class="input-field"
                      placeholder="Search or type new folder..."
                      autocomplete="off"
                    >
                  </div>
                  <div class="folder-dropdown-options" id="folder-dropdown-options">
                    <!-- Options populated by JavaScript -->
                  </div>
                </div>
              </div>
            </div>
          </div>
          <p class="form-helper" style="margin-top: var(--space-sm);">Add tags and folders to organize your QR codes</p>

          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" id="qr-favorite">
              <span class="form-label" style="margin: 0;">
                <i data-lucide="star" style="width: 14px; height: 14px; display: inline;"></i>
                Mark as Favorite
              </span>
            </label>
          </div>

          <!-- Show short URL only for URL types (dynamic QR codes) -->
          <div class="form-group" id="short-url-display" style="display: none;">
            <label class="form-label">
              <i data-lucide="link" style="width: 14px; height: 14px; display: inline;"></i>
              Short URL (permanent link in QR code)
            </label>
            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(245, 158, 11, 0.05)); padding: var(--space-md); border-radius: var(--radius-md); border: 1px solid rgba(16, 185, 129, 0.2);">
              <div style="font-family: monospace; font-size: var(--text-sm); color: var(--primary-emerald); word-break: break-all;">
                <span id="short-url-value">Generating...</span>
              </div>
            </div>
            <p class="form-helper">âœ“ This is a dynamic QR code. The QR contains this short URL. You can change where it redirects anytime!</p>
          </div>
        </div>

        <!-- Customization Section -->
        <div class="card" style="margin-bottom: var(--space-xl);">
          <h3 style="margin-bottom: var(--space-lg);">Customization</h3>

          <div class="form-group">
            <label class="form-label">Colors</label>
            <div style="display: flex; gap: var(--space-lg);">
              <div style="flex: 1;">
                <label class="form-label" for="qr-color-dark" style="font-size: var(--text-xs);">Foreground</label>
                <div style="display: flex; gap: var(--space-sm); align-items: center;">
                  <input type="color" id="qr-color-dark" class="color-input" value="#000000">
                  <input type="text" class="input-field" id="qr-color-dark-text" value="#000000" style="flex: 1;">
                </div>
              </div>
              <div style="flex: 1;">
                <label class="form-label" for="qr-color-light" style="font-size: var(--text-xs);">Background</label>
                <div style="display: flex; gap: var(--space-sm); align-items: center;">
                  <input type="color" id="qr-color-light" class="color-input" value="#ffffff">
                  <input type="text" class="input-field" id="qr-color-light-text" value="#ffffff" style="flex: 1;">
                </div>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Frame Style (optional)</label>
            <p class="form-helper" style="margin-top: 0;">Add a decorative frame around your QR code</p>
            <div class="qr-frame-grid">
              <div class="qr-frame-card active" data-frame="none">
                <div class="frame-preview frame-none">
                  <div class="frame-qr-mini"></div>
                </div>
                <span class="qr-frame-label">None</span>
              </div>
              <div class="qr-frame-card" data-frame="square">
                <div class="frame-preview frame-square">
                  <div class="frame-qr-mini"></div>
                  <div class="frame-text">SCAN ME</div>
                </div>
                <span class="qr-frame-label">Square</span>
              </div>
              <div class="qr-frame-card" data-frame="rounded">
                <div class="frame-preview frame-rounded">
                  <div class="frame-qr-mini"></div>
                  <div class="frame-text">SCAN ME</div>
                </div>
                <span class="qr-frame-label">Rounded</span>
              </div>
            </div>
            <input type="hidden" id="qr-frame" value="none">
          </div>

          <div class="form-group" id="frame-text-group" style="display: none;">
            <label class="form-label" for="qr-frame-text">Frame Text</label>
            <input
              type="text"
              id="qr-frame-text"
              class="input-field"
              placeholder="e.g., SCAN ME"
              maxlength="30"
              value="SCAN ME"
            >
          </div>

          <!-- Hidden error correction field (always Q/25%) -->
          <input type="hidden" id="qr-error-correction" value="Q">
        </div>

        <!-- Form Actions -->
        <div style="display: flex; gap: var(--space-md); flex-wrap: wrap;">
          <button type="submit" class="btn btn-primary btn-lg" id="save-btn">
            <i data-lucide="save" style="width: 18px; height: 18px;"></i>
            <span id="save-text">Create QR Code</span>
          </button>
          <a href="/dashboard" class="btn btn-secondary btn-lg">
            Cancel
          </a>
        </div>
      </form>
    </div>

    <!-- Preview Section -->
    <div style="width: 450px; background: var(--bg-primary); border-left: 1px solid var(--border-color); padding: var(--space-2xl); position: sticky; top: 73px; height: calc(100vh - 73px); overflow-y: auto; flex-shrink: 0;">
      <h3 style="margin-bottom: var(--space-lg);">Live Preview</h3>

      <div class="preview-box" id="preview-container">
        <p style="color: var(--text-tertiary);">Fill in the form to see preview</p>
      </div>

      <div style="margin-top: var(--space-lg);">
        <button class="btn btn-secondary" style="width: 100%;" id="generate-preview-btn">
          <i data-lucide="eye" style="width: 18px; height: 18px;"></i>
          Generate Preview
        </button>
      </div>

      <div style="margin-top: var(--space-lg);">
        <label class="form-label" style="margin-bottom: var(--space-sm);">Download As</label>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-sm);">
          <button type="button" class="btn btn-secondary" id="download-png" style="padding: var(--space-md) var(--space-lg);">
            <i data-lucide="download" style="width: 16px; height: 16px;"></i>
            PNG
          </button>
          <button type="button" class="btn btn-secondary" id="download-jpg" style="padding: var(--space-md) var(--space-lg);">
            <i data-lucide="download" style="width: 16px; height: 16px;"></i>
            JPG
          </button>
          <button type="button" class="btn btn-secondary" id="download-svg" style="padding: var(--space-md) var(--space-lg);">
            <i data-lucide="download" style="width: 16px; height: 16px;"></i>
            SVG
          </button>
          <button type="button" class="btn btn-secondary" id="download-pdf" style="padding: var(--space-md) var(--space-lg);">
            <i data-lucide="download" style="width: 16px; height: 16px;"></i>
            PDF
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <!-- QRCode.js Library - Load before qr-create.js -->
  <script src="/js/qrcode-bundle.js"></script>
  <!-- jsPDF for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="/js/qr-create.js"></script>
  <script>
    // Initialize Lucide icons
    lucide.createIcons();
  </script>
</body>
</html>
